<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Messages 游깳</title>
    <link rel="shortcut icon" type="image/x-icon" sizes="16x16" href="/assets/favicon.png" media="(prefers-color-scheme: dark)">
    <link rel="shortcut icon" type="image/x-icon" sizes="64x64" href="/assets/favicon.svg" media="(prefers-color-scheme: dark)">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #ffffff;
            color: #000000;
            transition: background-color 0.5s, color 0.5s;
        }

        h1 {
            color: #333;
            font-family: Arial, sans-serif;
        }

        textarea {
            width: 100%;
            height: 300px;
            margin-bottom: 10px;
            background-color: #f3f3f3;
            color: #000000;
            transition: background-color 0.5s, color 0.5s;
        }

        @media screen and (max-width: 600px) {
            textarea {
                height: 200px;
            }
        }

        @media screen and (max-width: 400px) {
            textarea {
                height: 150px;
            }
        }

        #pathToGo {
            text-align: center;
            margin-top: 240px;
            display: block;
        }

        #pathToGo form {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #pathToGo .prefix {
            padding: 8px 15px;
            display: flex;
            font-size: 14px;
            background-color: #dedede;
            margin-right: 0px;
            color: #000000;
        }

        #pathToGo input {
            padding: 7px;
            font-size: 14px;
            background-color: #f3f3f3;
            color: #999;
            transition: background-color 0.5s, color 0.5s;
            border: 1px solid #ccc;
        }

        #pathToGo button {
            padding: 8px 14px;
            font-size: 14px;
            cursor: pointer;
            background-color: #A9A9A9;
            color: #fff;
            border: none;
            transition: background-color 0.5s, color 0.5s;
        }

        #pathToGo button:hover {
            background-color: #363636;
        }

        #chatRoom {
            display: none;
        }

        #noLoginRequired {
            text-align: center;
            margin-top: 3px;
            color: #000000;
            font-size: 14px;
            display: block;
        }
    </style>
</head>

<body>
    <div id="pathToGo">
        <form onsubmit="createChatRoom(event)">
            <p class="prefix">cosmic.com/</p>
            <input type="search" name="path" id="search" autocapitalize="none" autocorrect="off" placeholder="your-secret-chat">
            <button type="submit" class="disabled">Go!</button>
        </form>
    </div>

    <div id="chatRoom">
        <h1>Send Your Cosmic Messages</h1>
        <textarea id="content" placeholder="Type your text here..."></textarea>
    </div>

    <div id="noLoginRequired">
        No login required
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.js"></script>
    <script>
        const socket = io();

        // Recuperar conte칰do do LocalStorage ao carregar a p치gina
        const storedContent = localStorage.getItem(getChatRoomId());
        if (storedContent) {
            document.getElementById('content').value = storedContent;
        }

        document.getElementById("content").addEventListener("input", function () {
            const contentTextarea = document.getElementById("content");
            const content = contentTextarea.value;

            // Armazenar conte칰do no LocalStorage
            localStorage.setItem(getChatRoomId(), content);

            socket.emit('updateContent', content);
        });

        function createChatRoom(event) {
            event.preventDefault();

            const pathInput = document.getElementById("search");
            const path = pathInput.value.trim();
            const pathToGo = document.getElementById('pathToGo');
            const chatRoom = document.getElementById('chatRoom');
            const noLoginRequired = document.getElementById('noLoginRequired');

            if (path !== "") {
                pathToGo.style.display = 'none';
                chatRoom.style.display = 'block';
                noLoginRequired.style.display = 'none';

                // Adicione esta linha para atualizar o hist칩rico do navegador
                window.location.hash = `#${path}`;
                // Adicione esta linha para atualizar o conte칰do da sala, se existir
                const storedContent = localStorage.getItem(getChatRoomId());
                if (storedContent) {
                    document.getElementById('content').value = storedContent;
                }
            }
        }

        // Adicione o c칩digo para manipular o evento hashchange
        window.addEventListener('hashchange', function () {
            const pathToGo = document.getElementById('pathToGo');
            const chatRoom = document.getElementById('chatRoom');
            const noLoginRequired = document.getElementById('noLoginRequired');

            if (window.location.hash === `#${getChatRoomId()}`) {
                // Se a hash for a sala de chat, exiba a sala de chat
                pathToGo.style.display = 'none';
                chatRoom.style.display = 'block';
                noLoginRequired.style.display = 'none';
            } else {
                // Se n칚o, exiba o caminho para ir
                pathToGo.style.display = 'block';
                chatRoom.style.display = 'none';
                noLoginRequired.style.display = 'block';
            }
        });

        // Adicione esta linha para garantir que o hash seja manipulado ao carregar a p치gina
        window.dispatchEvent(new Event('hashchange'));

        function getChatRoomId() {
            // Obtenha o identificador da sala a partir do fragmento de URL
            return window.location.hash.substr(1);
        }
    </script>
</body>

</html>
